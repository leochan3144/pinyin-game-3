<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™®é€šè©±æ‹¼éŸ³é¸æ“‡éŠæˆ²</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", "PingFang SC", "Hiragino Sans GB", sans-serif;
      padding: 15px;
      background: #f9f9f9;
      max-width: 100%;
      margin: 0 auto;
    }
    
    h1 {
      color: #007acc;
      font-size: clamp(1.5rem, 5vw, 2rem);
      text-align: center;
      margin-bottom: 20px;
    }
    
    h2 {
      font-size: clamp(1.2rem, 4vw, 1.5rem);
      text-align: center;
      margin: 15px 0;
      min-height: 3em;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    button {
      font-size: clamp(16px, 4vw, 18px);
      padding: 12px 20px;
      margin: 8px 0;
      width: 100%;
      max-width: 500px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    
    button:hover {
      opacity: 0.9;
      transform: scale(1.02);
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    .hidden {
      display: none;
    }
    
    .feedback {
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
      font-size: clamp(16px, 4vw, 18px);
      min-height: 2em;
    }
    
    #next-btn {
      background-color: #4CAF50;
      color: white;
      margin-top: 25px;
      font-weight: bold;
    }
    
    #start-screen, #game-area, #end-screen {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    #question-count {
      font-size: clamp(16px, 4vw, 18px);
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ddd;
      margin-left: 10px;
    }
    
    label {
      font-size: clamp(16px, 4vw, 18px);
    }
    
    #options {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    
    #options button {
      background-color: #f0f0f0;
    }
    
    #options button:hover {
      background-color: #e0e0e0;
    }
    
    #score-display {
      text-align: center;
      margin: 15px 0;
      font-size: clamp(16px, 4vw, 18px);
    }
    
    #pronunciation-btn {
      background-color: #2196F3;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      #start-screen, #game-area, #end-screen {
        padding: 15px;
      }
      
      button {
        padding: 10px 15px;
      }
    }
  </style>
</head>
<body>
<h1>ğŸ® æ™®é€šè©±æ‹¼éŸ³é¸æ“‡éŠæˆ²</h1>

<div id="start-screen">
  <label>é¸æ“‡é¡Œæ•¸ï¼š
    <select id="question-count">
      <option value="5">5é¡Œ</option>
      <option value="10" selected>10é¡Œ</option>
      <option value="20">20é¡Œ</option>
    </select>
  </label>
  <br><br>
  <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
</div>

<div id="game-area" class="hidden">
  <h2 id="word-display"></h2>
  <button id="pronunciation-btn" onclick="playPronunciation()">
    <span>ğŸ”Š</span> æ’­æ”¾ç™¼éŸ³
  </button>
  <div id="options"></div>
  <div class="feedback" id="feedback"></div>
  <div id="score-display">
    å¾—åˆ†ï¼š<span id="score">0</span> ï¼ é¡Œè™Ÿï¼š<span id="current">1</span> / <span id="total"></span>
  </div>
  <button id="next-btn" class="hidden" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
</div>

<div id="end-screen" class="hidden">
  <h2>ğŸ‰ éŠæˆ²çµæŸï¼</h2>
  <p style="text-align: center; font-size: 1.2rem;">ä½ çš„å¾—åˆ†æ˜¯ï¼š<span id="final-score"></span></p>
  <button onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
</div>

<script>
const wordBank = [
{ word: "æ©Ÿå ´", pinyin: "jÄ« chÇng" },  
{ word: "ç«è»Šç«™", pinyin: "huÇ’ chÄ“ zhÃ n" },  
{ word: "åœ°éµ", pinyin: "dÃ¬ tiÄ›" },  
{ word: "å…¬äº¤è»Š", pinyin: "gÅng jiÄo chÄ“" },  
{ word: "å‡ºç§Ÿè»Š", pinyin: "chÅ« zÅ« chÄ“" },  
{ word: "ç¥¨", pinyin: "piÃ o" },  
{ word: "ç™»æ©Ÿå£", pinyin: "dÄ“ng jÄ« kÇ’u" },  
{ word: "è¡Œæ", pinyin: "xÃ­ng li" },  
{ word: "è­·ç…§", pinyin: "hÃ¹ zhÃ o" },  
{ word: "ç°½è­‰", pinyin: "qiÄn zhÃ¨ng" },  
{ word: "èˆªç­", pinyin: "hÃ¡ng bÄn" },  
{ word: "å»¶èª¤", pinyin: "yÃ¡n wÃ¹" },  
{ word: "å‡ºå£", pinyin: "chÅ« kÇ’u" },  
{ word: "å…¥å£", pinyin: "rÃ¹ kÇ’u" },  
{ word: "ç«™å°", pinyin: "zhÃ n tÃ¡i" },  
{ word: "å”®ç¥¨è™•", pinyin: "shÃ²u piÃ o chÃ¹" },  
{ word: "è¡Œæå¯„å­˜", pinyin: "xÃ­ng li jÃ¬ cÃºn" },  
{ word: "å®‰æª¢", pinyin: "Än jiÇn" },  
{ word: "è½‰æ©Ÿ", pinyin: "zhuÇn jÄ«" },  
{ word: "çµ‚é»ç«™", pinyin: "zhÅng diÇn zhÃ n" },  
{ word: "é…’åº—", pinyin: "jiÇ” diÃ n" },  
{ word: "æˆ¿é–“", pinyin: "fÃ¡ng jiÄn" },  
{ word: "é è¨‚", pinyin: "yÃ¹ dÃ¬ng" },  
{ word: "å‰è‡º", pinyin: "qiÃ¡n tÃ¡i" },  
{ word: "é‘°åŒ™", pinyin: "yÃ o shi" },  
{ word: "é€€æˆ¿", pinyin: "tuÃ¬ fÃ¡ng" },  
{ word: "å–®äººæˆ¿", pinyin: "dÄn rÃ©n fÃ¡ng" },  
{ word: "é›™äººæˆ¿", pinyin: "shuÄng rÃ©n fÃ¡ng" },  
{ word: "æ—©é¤", pinyin: "zÇo cÄn" },  
{ word: "ç©ºèª¿", pinyin: "kÅng tiÃ¡o" },  
{ word: "æµ´å®¤", pinyin: "yÃ¹ shÃ¬" },  
{ word: "æ¯›å·¾", pinyin: "mÃ¡o jÄ«n" },  
{ word: "æ•é ­", pinyin: "zhÄ›n tou" },  
{ word: "æ¯¯å­", pinyin: "tÇn zi" },  
{ word: "å«é†’æœå‹™", pinyin: "jiÃ o xÇng fÃº wÃ¹" },  
{ word: "æˆ¿å¡", pinyin: "fÃ¡ng kÇ" },  
{ word: "æ´—è¡£æœå‹™", pinyin: "xÇ yÄ« fÃº wÃ¹" },  
{ word: "é›»æ¢¯", pinyin: "diÃ n tÄ«" },  
{ word: "æ¨“å±¤", pinyin: "lÃ³u cÃ©ng" },  
{ word: "é¤å»³", pinyin: "cÄn tÄ«ng" },  
{ word: "èœå–®", pinyin: "cÃ i dÄn" },  
{ word: "æ°´", pinyin: "shuÇ" },  
{ word: "å’–å•¡", pinyin: "kÄ fÄ“i" },  
{ word: "èŒ¶", pinyin: "chÃ¡" },  
{ word: "å•¤é…’", pinyin: "pÃ­ jiÇ”" },  
{ word: "ç´ é£Ÿ", pinyin: "sÃ¹ shÃ­" },  
{ word: "è¾£", pinyin: "lÃ " },  
{ word: "ç”œ", pinyin: "tiÃ¡n" },  
{ word: "è²·å–®", pinyin: "mÇi dÄn" },  
{ word: "ç­·å­", pinyin: "kuÃ i zi" },  
{ word: "å‹ºå­", pinyin: "shÃ¡o zi" },  
{ word: "å‰å­", pinyin: "chÄ zi" },  
{ word: "ç¢—", pinyin: "wÇn" },  
{ word: "æ¯å­", pinyin: "bÄ“i zi" },  
{ word: "å†°å¡Š", pinyin: "bÄ«ng kuÃ i" },  
{ word: "æœå‹™å“¡", pinyin: "fÃº wÃ¹ yuÃ¡n" },  
{ word: "æ‰“åŒ…", pinyin: "dÇ bÄo" },  
{ word: "æ¨è–¦èœ", pinyin: "tuÄ« jiÃ n cÃ i" },  
{ word: "å¥½åƒ", pinyin: "hÇo chÄ«" },  
{ word: "åšç‰©é¤¨", pinyin: "bÃ³ wÃ¹ guÇn" },  
{ word: "å…¬åœ’", pinyin: "gÅng yuÃ¡n" },  
{ word: "æµ·ç˜", pinyin: "hÇi tÄn" },  
{ word: "åœ°åœ–", pinyin: "dÃ¬ tÃº" },  
{ word: "å°éŠ", pinyin: "dÇo yÃ³u" },  
{ word: "æ‹ç…§", pinyin: "pÄi zhÃ o" },  
{ word: "é–€ç¥¨", pinyin: "mÃ©n piÃ o" },  
{ word: "ç´€å¿µå“", pinyin: "jÃ¬ niÃ n pÇn" },  
{ word: "çˆ¬å±±", pinyin: "pÃ¡ shÄn" },  
{ word: "æ¸¸æ³³", pinyin: "yÃ³u yÇ’ng" },  
{ word: "åˆ’èˆ¹", pinyin: "huÃ¡ chuÃ¡n" },  
{ word: "è‡ªè¡Œè»Š", pinyin: "zÃ¬ xÃ­ng chÄ“" },  
{ word: "çºœè»Š", pinyin: "lÇn chÄ“" },  
{ word: "å¯ºå»Ÿ", pinyin: "sÃ¬ miÃ o" },  
{ word: "åŸå ¡", pinyin: "chÃ©ng bÇo" },  
{ word: "å»£å ´", pinyin: "guÇng chÇng" },  
{ word: "å™´æ³‰", pinyin: "pÄ“n quÃ¡n" },  
{ word: "å‹•ç‰©åœ’", pinyin: "dÃ²ng wÃ¹ yuÃ¡n" },  
{ word: "éŠæ¨‚åœ’", pinyin: "yÃ³u lÃ¨ yuÃ¡n" },  
{ word: "å¤œå¸‚", pinyin: "yÃ¨ shÃ¬" },  
{ word: "å•†åº—", pinyin: "shÄng diÃ n" },  
{ word: "åƒ¹æ ¼", pinyin: "jiÃ  gÃ©" },  
{ word: "ä¾¿å®œ", pinyin: "piÃ¡n yi" },  
{ word: "è²´", pinyin: "guÃ¬" },  
{ word: "æ‰“æŠ˜", pinyin: "dÇ zhÃ©" },  
{ word: "ä¿¡ç”¨å¡", pinyin: "xÃ¬n yÃ²ng kÇ" },  
{ word: "ç¾é‡‘", pinyin: "xiÃ n jÄ«n" },  
{ word: "è©¦ç©¿", pinyin: "shÃ¬ chuÄn" },  
{ word: "å°ºå¯¸", pinyin: "chÇ cÃ¹n" },  
{ word: "é€€ç¨…", pinyin: "tuÃ¬ shuÃ¬" },  
{ word: "è³¼ç‰©è¢‹", pinyin: "gÃ²u wÃ¹ dÃ i" },  
{ word: "è¶…å¸‚", pinyin: "chÄo shÃ¬" },  
{ word: "å¸‚å ´", pinyin: "shÃ¬ chÇng" },  
{ word: "ç¦®ç‰©", pinyin: "lÇ wÃ¹" },  
{ word: "æ‰‹éŒ¶", pinyin: "shÇ’u biÇo" },  
{ word: "è¡£æœ", pinyin: "yÄ« fu" },  
{ word: "é‹å­", pinyin: "xiÃ© zi" },  
{ word: "åŒ–å¦å“", pinyin: "huÃ  zhuÄng pÇn" },  
{ word: "é›»å­ç”¢å“", pinyin: "diÃ n zÇ chÇn pÇn" },  
{ word: "ç‰¹ç”¢", pinyin: "tÃ¨ chÇn" },  
{ word: "é†«é™¢", pinyin: "yÄ« yuÃ n" },  
{ word: "è­¦å¯Ÿ", pinyin: "jÇng chÃ¡" },  
{ word: "æ•‘å‘½", pinyin: "jiÃ¹ mÃ¬ng" },  
{ word: "è—¥", pinyin: "yÃ o" },  
{ word: "ä¸èˆ’æœ", pinyin: "bÃ¹ shÅ« fu" },  
{ word: "éæ•", pinyin: "guÃ² mÇn" },  
{ word: "å»æ‰€", pinyin: "cÃ¨ suÇ’" },  
{ word: "è¿·è·¯", pinyin: "mÃ­ lÃ¹" },  
{ word: "éŒ¢åŒ…ä¸Ÿäº†", pinyin: "qiÃ¡n bÄo diÅ« le" },  
{ word: "ä½¿é¤¨", pinyin: "shÇ guÇn" },  
{ word: "æ•‘è­·è»Š", pinyin: "jiÃ¹ hÃ¹ chÄ“" },  
{ word: "é ­ç—›", pinyin: "tÃ³u tÃ²ng" },  
{ word: "ç™¼ç‡’", pinyin: "fÄ shÄo" },  
{ word: "æ„Ÿå†’", pinyin: "gÇn mÃ o" },  
{ word: "é†«ç”Ÿ", pinyin: "yÄ« shÄ“ng" },  
{ word: "è­·å£«", pinyin: "hÃ¹ shi" },  
{ word: "è—¥åº—", pinyin: "yÃ o diÃ n" },  
{ word: "æ¶ˆæ¯’", pinyin: "xiÄo dÃº" },  
{ word: "ç¹ƒå¸¶", pinyin: "jiÇn dÃ i" },  
{ word: "ç·Šæ€¥é›»è©±", pinyin: "jÇn jÃ­ diÃ n huÃ " },  
{ word: "ä½ å¥½ï¼", pinyin: "nÇ hÇo!" },  
{ word: "æ—©ä¸Šå¥½", pinyin: "zÇo shang hÇo" },  
{ word: "æ™šä¸Šå¥½", pinyin: "wÇn shang hÇo" },  
{ word: "å†è¦‹", pinyin: "zÃ i jiÃ n" },  
{ word: "æˆ‘å«...", pinyin: "wÇ’ jiÃ o..." },  
{ word: "ä½ å«ä»€éº¼åå­—ï¼Ÿ", pinyin: "nÇ jiÃ o shÃ©n me mÃ­ng zi?" },  
{ word: "æˆ‘æ˜¯éŠå®¢", pinyin: "wÇ’ shÃ¬ yÃ³u kÃ¨" },  
{ word: "æˆ‘ä¾†è‡ª...", pinyin: "wÇ’ lÃ¡i zÃ¬..." },  
{ word: "å¾ˆé«˜èˆˆèªè­˜ä½ ", pinyin: "hÄ›n gÄo xÃ¬ng rÃ¨n shi nÇ" },  
{ word: "ä½ æœƒèªªè‹±èªå—ï¼Ÿ", pinyin: "nÇ huÃ¬ shuÅ yÄ«ng yÇ” ma?" },  
{ word: "è«‹å•åœ°éµç«™æ€éº¼èµ°ï¼Ÿ", pinyin: "qÇng wÃ¨n dÃ¬ tiÄ› zhÃ n zÄ›n me zÇ’u?" },  
{ word: "é™„è¿‘æœ‰è¶…å¸‚å—ï¼Ÿ", pinyin: "fÃ¹ jÃ¬n yÇ’u chÄo shÃ¬ ma?" },  
{ word: "æˆ‘æƒ³å»...", pinyin: "wÇ’ xiÇng qÃ¹..." },  
{ word: "é ä¸é ï¼Ÿ", pinyin: "yuÇn bu yuÇn?" },  
{ word: "èµ°è·¯è¦å¤šä¹…ï¼Ÿ", pinyin: "zÇ’u lÃ¹ yÃ o duÅ jiÇ”?" },  
{ word: "è«‹åœ¨åœ°åœ–ä¸ŠæŒ‡çµ¦æˆ‘çœ‹", pinyin: "qÇng zÃ i dÃ¬ tÃº shang zhÇ gÄ›i wÇ’ kÃ n" },  
{ word: "å·¦è½‰", pinyin: "zuÇ’ zhuÇn" },  
{ word: "å³è½‰", pinyin: "yÃ²u zhuÇn" },  
{ word: "ç›´èµ°", pinyin: "zhÃ­ zÇ’u" },  
{ word: "é€™è£¡æ˜¯å“ªè£¡ï¼Ÿ", pinyin: "zhÃ¨ lÇ shÃ¬ nÇ lÇ?" },  
{ word: "é€™å€‹å¤šå°‘éŒ¢ï¼Ÿ", pinyin: "zhÃ¨ ge duÅ shÇo qiÃ¡n?" },  
{ word: "å¤ªè²´äº†", pinyin: "tÃ i guÃ¬ le" },  
{ word: "å¯ä»¥ä¾¿å®œä¸€é»å—ï¼Ÿ", pinyin: "kÄ› yÇ piÃ¡n yi yÄ« diÇn ma?" },  
{ word: "æˆ‘è¦é€™å€‹", pinyin: "wÇ’ yÃ o zhÃ¨ ge" },  
{ word: "æœ‰æ²’æœ‰å…¶ä»–é¡è‰²ï¼Ÿ", pinyin: "yÇ’u mÃ©i yÇ’u qÃ­ tÄ yÃ¡n sÃ¨?" },  
{ word: "å¯ä»¥è©¦ç©¿å—ï¼Ÿ", pinyin: "kÄ› yÇ shÃ¬ chuÄn ma?" },  
{ word: "åˆ·å¡é‚„æ˜¯ç¾é‡‘ï¼Ÿ", pinyin: "shuÄ kÇ hÃ¡i shÃ¬ xiÃ n jÄ«n?" },  
{ word: "æœ‰æŠ˜æ‰£å—ï¼Ÿ", pinyin: "yÇ’u zhÃ© kÃ²u ma?" },  
{ word: "æˆ‘ä¸éœ€è¦", pinyin: "wÇ’ bÃ¹ xÅ« yÃ o" },  
{ word: "æˆ‘åªæ˜¯çœ‹çœ‹", pinyin: "wÇ’ zhÇ shÃ¬ kÃ n kan" },  
{ word: "æœ‰è‹±æ–‡èœå–®å—ï¼Ÿ", pinyin: "yÇ’u yÄ«ng wÃ©n cÃ i dÄn ma?" },  
{ word: "è«‹çµ¦æˆ‘...", pinyin: "qÇng gÄ›i wÇ’..." },  
{ word: "ä¸è¦è¾£", pinyin: "bÃº yÃ o lÃ " },  
{ word: "å°‘æ”¾é¹½", pinyin: "shÇo fÃ ng yÃ¡n" },  
{ word: "æˆ‘æ˜¯ç´ é£Ÿè€…", pinyin: "wÇ’ shÃ¬ sÃ¹ shÃ­ zhÄ›" },  
{ word: "é€™å€‹å¥½åƒå—ï¼Ÿ", pinyin: "zhÃ¨ ge hÇo chÄ« ma?" },  
{ word: "è«‹åŠ å†°", pinyin: "qÇng jiÄ bÄ«ng" },  
{ word: "è«‹çµ¦æˆ‘æ°´", pinyin: "qÇng gÄ›i wÇ’ shuÇ" },  
{ word: "çµå¸³", pinyin: "jiÃ© zhÃ ng" },  
{ word: "å¯ä»¥åˆ†é–‹ä»˜å—ï¼Ÿ", pinyin: "kÄ› yÇ fÄ“n kÄi fÃ¹ ma?" },  
{ word: "å¹«å¹«æˆ‘ï¼", pinyin: "bÄng bÄng wÇ’!" },  
{ word: "æˆ‘ç”Ÿç—…äº†", pinyin: "wÇ’ shÄ“ng bÃ¬ng le" },  
{ word: "æˆ‘éœ€è¦é†«ç”Ÿ", pinyin: "wÇ’ xÅ« yÃ o yÄ« shÄ“ng" },  
{ word: "æˆ‘çš„éŒ¢åŒ…è¢«å·äº†", pinyin: "wÇ’ de qiÃ¡n bÄo bÃ¨i tÅu le" },  
{ word: "è«‹å ±è­¦", pinyin: "qÇng bÃ o jÇng" },  
{ word: "é€™è£¡æœ‰é†«é™¢å—ï¼Ÿ", pinyin: "zhÃ¨ lÇ yÇ’u yÄ« yuÃ n ma?" },  
{ word: "æˆ‘éæ•", pinyin: "wÇ’ guÃ² mÇn" },  
{ word: "æˆ‘è¿·è·¯äº†", pinyin: "wÇ’ mÃ­ lÃ¹ le" },  
{ word: "è«‹è¯ç¹«ä¸­åœ‹å¤§ä½¿é¤¨", pinyin: "qÇng liÃ¡n xÃ¬ zhÅng guÃ³ dÃ  shÇ guÇn" },  
{ word: "æˆ‘çš„è­·ç…§ä¸Ÿäº†", pinyin: "wÇ’ de hÃ¹ zhÃ o diÅ« le" },  
{ word: "1, 2, 3, 4, 5", pinyin: "yÄ«, Ã¨r, sÄn, sÃ¬, wÇ”" },  
{ word: "6, 7, 8, 9, 10", pinyin: "liÃ¹, qÄ«, bÄ, jiÇ”, shÃ­" },  
{ word: "ç¾åœ¨å¹¾é»ï¼Ÿ", pinyin: "xiÃ n zÃ i jÇ diÇn?" },  
{ word: "ä»Šå¤©", pinyin: "jÄ«n tiÄn" },  
{ word: "æ˜å¤©", pinyin: "mÃ­ng tiÄn" },  
{ word: "æ˜¨å¤©", pinyin: "zuÃ³ tiÄn" },  
{ word: "æ—©ä¸Š", pinyin: "zÇo shang" },  
{ word: "ä¸‹åˆ", pinyin: "xiÃ  wÇ”" },  
{ word: "æ™šä¸Š", pinyin: "wÇn shang" },  
{ word: "ä¸€å°æ™‚å¾Œ", pinyin: "yÄ« xiÇo shÃ­ hÃ²u" },  
{ word: "å¯ä»¥æ‹ç…§å—ï¼Ÿ", pinyin: "kÄ› yÇ pÄi zhÃ o ma?" },  
{ word: "é€™è£¡æœ‰å»æ‰€å—ï¼Ÿ", pinyin: "zhÃ¨ lÇ yÇ’u cÃ¨ suÇ’ ma?" },  
{ word: "å…è²»å—ï¼Ÿ", pinyin: "miÇn fÃ¨i ma?" },  
{ word: "Wi-Fiå¯†ç¢¼æ˜¯å¤šå°‘ï¼Ÿ", pinyin: "wÇi fÄi mÃ¬ mÇ shÃ¬ duÅ shÇo?" },  
{ word: "è«‹èªªæ…¢ä¸€é»", pinyin: "qÇng shuÅ mÃ n yÄ« diÇn" },  
{ word: "æˆ‘ä¸æ˜ç™½", pinyin: "wÇ’ bÃ¹ mÃ­ng bai" },  
{ word: "è«‹å¯«ä¸‹ä¾†", pinyin: "qÇng xiÄ› xiÃ  lÃ¡i" },  
{ word: "å¤ªæ£’äº†ï¼", pinyin: "tÃ i bÃ ng le!" },  
{ word: "ä¸‹æ¬¡è¦‹ï¼", pinyin: "xiÃ  cÃ¬ jiÃ n!" }
];

const confusables = {
  "initials": {
    "zh": ["z", "ch"],
    "ch": ["zh", "q"],
    "sh": ["s", "x"],
    "z": ["zh", "j"],
    "c": ["ch", "q"],
    "s": ["sh", "x"],
    "j": ["z", "q"],
    "q": ["c", "ch"],
    "x": ["sh", "s"],
    "b": ["p", "d"],
    "d": ["b", "t"],
    "t": ["d", "k"],
    "g": ["k", "h"],
    "k": ["g", "t"],
    "h": ["k", "x"]
  },
  "finals": {
    "ang": ["an", "eng"],
    "eng": ["ang", "en"],
    "ing": ["in", "iang"],
    "in": ["ing", "ian"],
    "ian": ["in", "iang"],
    "iang": ["ian", "ing"],
    "ao": ["ou", "an"],
    "ou": ["ao", "o"],
    "an": ["ang", "en"],
    "en": ["eng", "an"],
    "ong": ["eng", "uang"]
  }
};

let questions = [];
let current = 0, score = 0, total = 0;

function startGame() {
  total = parseInt(document.getElementById("question-count").value);
  questions = shuffleArray(wordBank).slice(0, total);
  document.getElementById("start-screen").classList.add("hidden");
  document.getElementById("game-area").classList.remove("hidden");
  document.getElementById("total").textContent = total;
  showQuestion();
}

function showQuestion() {
  let item = questions[current];
  document.getElementById("word-display").textContent = item.word;
  document.getElementById("feedback").textContent = "";
  document.getElementById("current").textContent = current + 1;
  document.getElementById("next-btn").classList.add("hidden");

  let correct = item.pinyin;
  let options = generateConfusableOptions(correct);
  options = shuffleArray([correct, ...options.slice(0, 3)]);

  let container = document.getElementById("options");
  container.innerHTML = "";
  options.forEach(p => {
    let btn = document.createElement("button");
    btn.textContent = p;
    btn.onclick = () => checkAnswer(p, correct);
    container.appendChild(btn);
  });
}

function checkAnswer(selected, correct) {
  let fb = document.getElementById("feedback");
  if (selected === correct) {
    score++;
    fb.textContent = "âœ… æ­£ç¢ºï¼";
    fb.style.color = "#4CAF50";
  } else {
    fb.textContent = `âŒ éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correct}`;
    fb.style.color = "#f44336";
  }
  document.getElementById("score").textContent = score;

  // ç¦ç”¨æ‰€æœ‰é¸é …æŒ‰éˆ•
  document.querySelectorAll("#options button").forEach(btn => {
    btn.disabled = true;
    if (btn.textContent === correct) {
      btn.style.backgroundColor = "#4CAF50";
      btn.style.color = "white";
    } else if (btn.textContent === selected && selected !== correct) {
      btn.style.backgroundColor = "#f44336";
      btn.style.color = "white";
    }
  });
  
  // é¡¯ç¤ºã€Œä¸‹ä¸€é¡Œã€æŒ‰éˆ•
  document.getElementById("next-btn").classList.remove("hidden");
}

function nextQuestion() {
  // å•Ÿç”¨æ‰€æœ‰é¸é …æŒ‰éˆ•
  document.querySelectorAll("#options button").forEach(btn => {
    btn.disabled = false;
    btn.style.backgroundColor = "#f0f0f0";
    btn.style.color = "black";
  });
  
  current++;
  if (current < total) {
    showQuestion();
  } else {
    endGame();
  }
}

function endGame() {
  document.getElementById("game-area").classList.add("hidden");
  document.getElementById("end-screen").classList.remove("hidden");
  document.getElementById("final-score").textContent = `${score} / ${total}`;
}

function playPronunciation() {
  let word = questions[current].word;
  let utter = new SpeechSynthesisUtterance(word);
  utter.lang = "zh-CN";
  utter.rate = 0.9;
  speechSynthesis.speak(utter);
}

function shuffleArray(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function generateConfusableOptions(correct) {
  const tones = {
    'a': ['Ä','Ã¡','Ç','Ã '],
    'e': ['Ä“','Ã©','Ä›','Ã¨'],
    'i': ['Ä«','Ã­','Ç','Ã¬'],
    'o': ['Å','Ã³','Ç’','Ã²'],
    'u': ['Å«','Ãº','Ç”','Ã¹'],
    'Ã¼': ['Ç–','Ç˜','Çš','Çœ']
  };
  const toneMap = {
    'Ä':'a','Ã¡':'a','Ç':'a','Ã ':'a',
    'Ä“':'e','Ã©':'e','Ä›':'e','Ã¨':'e',
    'Ä«':'i','Ã­':'i','Ç':'i','Ã¬':'i',
    'Å':'o','Ã³':'o','Ç’':'o','Ã²':'o',
    'Å«':'u','Ãº':'u','Ç”':'u','Ã¹':'u',
    'Ç–':'Ã¼','Ç˜':'Ã¼','Çš':'Ã¼','Çœ':'Ã¼'
  };
  const removeTone = (pinyin) => pinyin.split('').map(c => toneMap[c] || c).join('');
  const applyTone = (syl) => {
    for (let v in tones) {
      if (syl.includes(v)) {
        return syl.replace(v, tones[v][Math.floor(Math.random()*4)]);
      }
    }
    return syl;
  };

  let noToneParts = removeTone(correct).split(" ");
  let variations = new Set();

  while (variations.size < 10) {
    let variation = noToneParts.map(syl => {
      let init = Object.keys(confusables.initials).find(i => syl.startsWith(i));
      let fin = Object.keys(confusables.finals).find(f => syl.endsWith(f));
      let newSyl = syl;
      if (init && confusables.initials[init]) {
        let newInit = confusables.initials[init][Math.floor(Math.random() * confusables.initials[init].length)];
        newSyl = newSyl.replace(init, newInit);
      }
      if (fin && confusables.finals[fin]) {
        let newFin = confusables.finals[fin][Math.floor(Math.random() * confusables.finals[fin].length)];
        newSyl = newSyl.replace(fin, newFin);
      }
      return applyTone(newSyl);
    }).join(" ");
    if (variation !== correct) variations.add(variation);
  }

  return Array.from(variations);
}
</script>
</body>
</html>
